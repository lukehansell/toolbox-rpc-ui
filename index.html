<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <title>Dockyard RPC UI</title>
    <link rel="stylesheet" href="https://cdn.rawgit.com/Chalarangelo/mini.css/v3.0.1/dist/mini-default.min.css">
  </head>
  <body style="height: 100vh; display: flex; flex-direction: column;">
    <div style="flex: 0 1 auto; width: 100vw">
      <div class="container">
        <form onsubmit="return handleSubmit(event)">
          <div class="row responsive-label">
            <div class="col-sm-12 col-md-3">
              <label for="service">
                Service Name
              </label>
            </div>
            <div class="col-sm-12 col-md">
              <input name="service-name" id="service" style="width: 85%;" />
            </div>
          </div>
          <div class="row responsive-label">
            <div class="col-sm-12 col-md-3">
              <label for="environment">
                Environment
              </label>
            </div>
            <div class="col-sm-12 col-md">
              <select id="environment" style="width: 85%;">
                <option value="development">development</option>
                <option value="production">production</option>
              </select>
            </div>
          </div>
          <div class="row responsive-label">
            <div class="col-sm-12 col-md-3">
              <label for="function-name" required="required">
                Function
              </label>
            </div>
            <div class="col-sm-12 col-md">
              <input name="function-name" id="function-name" style="width: 85%;" />
            </div>
          </div>
          <div class="row responsive-label">
            <div class="col-sm-12 col-md-3">
              <label for="data">
                Data
              </label>
            </div>
            <div class="col-sm-12 col-md">
              <textarea id="data" style="width: 85%;"></textarea>
            </div>
          </div>
          <input type="submit" class="primary" />
        </form>
      </div>
    </div>
    <div style="flex:1 1 auto; overflow-y: scroll;" id="result-container">
      <div id="result" class="container"></div>
    </div>
    <script>
      const updateScroll = (id) => {
        const element = document.getElementById(id);
        element.scrollTop = element.scrollHeight;
      }

      const writeResult = (result) => {
        const row = document.createElement('div')
        row.className = 'row'
        const code = document.createElement('pre')
        code.innerText = JSON.stringify(result)
        row.appendChild(code)
        document.getElementById('result').appendChild(row)
        updateScroll("result-container")
      }

      const handleSubmit = (e) => {
        e.preventDefault()

        const requestParams = {
          service: document.getElementById('service').value,
          fn: document.getElementById('function-name').value,
          environment: document.getElementById('environment').value,
          data: document.getElementById('data').value
        }

        window.api.send('rpcRequest', requestParams)
        return false
      }

      window.api.receive('rpcResponse', data => writeResult(data))
      window.api.receive('rpcError', data => writeResult(data))
    </script>
  </body>
</html>